{"version":3,"file":null,"sources":["../src/widget.js"],"sourcesContent":["const {rpc, React, store} = Serverboards\nconst plugin_id=\"serverboards.plugin.serviceheatmap\"\n\nconst Model = React.createClass({\n  getInitialState(){\n    return {\n      services: store.getState().serverboard.serverboard.services,\n      size: 20\n    }\n  },\n  updateServices(){\n    this.setState( {\n      services: store.getState().serverboard.serverboard.services\n    } )\n  },\n  componentDidMount(){\n    this.unsubscribe = store.subscribe( () => this.updateServices() )\n    // This is the initial size, but it will make last row unfilled, butcutted, same last column\n    let size = Math.floor( Math.sqrt(\n      (this.props.layout.width*this.props.layout.height*280*240) / this.state.services.length\n    ) )\n    let ok = false\n    let per_row, row_count, max_row_count\n    while( !ok ){\n      per_row = Math.floor( this.props.layout.width * 280 / size )\n      max_row_count = Math.floor( this.props.layout.height * 240 / size )\n      row_count = Math.ceil( this.state.services.length /  per_row )\n      ok = (row_count <= max_row_count )\n      if (!ok)\n        size-=1\n      if (size<20){\n        break;\n      }\n    }\n    this.setState({size: size - 2})\n  },\n  componentWillUnmount(){\n    this.unsubscribe()\n  },\n  render(){\n    return <View services={this.state.services} size={this.state.size}/>\n  }\n})\n\nfunction logo(name){\n  let ns=name.split(' ')\n  if (ns.length>=2){\n    return ns.map((n) => n[0]).join('').slice(0,2).toUpperCase()\n  }\n  return name.slice(0,2).toUpperCase()\n}\n\nconst Cell = React.createClass({\n  componentDidMount(){\n    $(this.refs.el).popup({\n      position: \"bottom center\"\n    })\n  },\n  gotoService(){\n    $(this.refs.el).popup(\"destroy\")\n    Serverboards.store.goto(`/services/${this.props.service.uuid}`)\n  },\n  render(){\n    const {service, cell_style} = this.props\n    const title = `${service.name}: ${service.tags.join(', ')}`\n    return (\n      <div\n        ref=\"el\"\n        className={`cell ${Serverboards.utils.colorize(service.tags[0] || \"\")}`}\n        title={title}\n        data-content={title}\n        onClick={this.gotoService}\n        style={cell_style}\n        >\n          {logo(service.name)}\n      </div>\n      )\n  }\n})\n\nfunction View(props){\n  const cell_style = {\n    width: props.size,\n    minWidth: props.size,\n    height: props.size,\n    cursor: \"pointer\",\n    display: \"flex\",\n    justifyContent: \"flex-start\",\n    alignItems: \"flex-start\",\n    color: \"white\",\n    padding: \"5px 10px\",\n    fontSize: Math.max(props.size/5, 12)\n  }\n  return (\n    <div className=\"ui heatmap\" style={{justifyContent:\"center\"}}>\n      {props.services.map( (s) => (\n        <Cell key={s.uuid} service={s} cell_style={cell_style}/>\n      ) ) }\n    </div>\n  )\n}\n\nfunction main(el, config, extra){\n  console.log(extra)\n  Serverboards.ReactDOM.render(<Model layout={extra.layout}/>, el)\n\n  return function(){\n    Serverboards.ReactDOM.unmountComponentAtNode(el)\n  }\n}\n\nServerboards.add_widget(`${plugin_id}/widget`, main)\n"],"names":["Serverboards","rpc","React","store","plugin_id","Model","createClass","getInitialState","services","getState","serverboard","size","updateServices","setState","componentDidMount","unsubscribe","subscribe","Math","floor","sqrt","props","layout","width","height","state","length","ok","per_row","row_count","max_row_count","ceil","componentWillUnmount","render","name","split","ns","map","n","join","slice","toUpperCase","$","refs","el","popup","position","gotoService","goto","service","uuid","cell_style","title","tags","utils","colorize","logo","minWidth","cursor","display","justifyContent","alignItems","color","padding","fontSize","max","s","config","extra","log","ReactDOM","unmountComponentAtNode","add_widget","main"],"mappings":"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"}