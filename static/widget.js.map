{"version":3,"file":null,"sources":["../src/widget.js"],"sourcesContent":["const {rpc, React, store} = Serverboards\nconst plugin_id=\"serverboards.plugin.serviceheatmap\"\n\nconst Model = React.createClass({\n  getInitialState(){\n    return {\n      services: store.getState().serverboard.serverboard.services,\n      size: 20\n    }\n  },\n  updateServices(){\n    this.setState( {\n      services: store.getState().serverboard.serverboard.services\n    } )\n  },\n  componentDidMount(){\n    this.unsubscribe = store.subscribe( () => this.updateServices() )\n    // This is the initial size, but it will make last row unfilled, butcutted, same last column\n    let size = Math.floor( Math.sqrt(\n      (this.props.layout.width*this.props.layout.height*280*240) / this.state.services.length\n    ) )\n    let ok = false\n    let per_row, row_count, max_row_count\n    while( !ok ){\n      per_row = Math.floor( this.props.layout.width * 280 / size )\n      max_row_count = Math.floor( this.props.layout.height * 240 / size )\n      row_count = Math.ceil( this.state.services.length /  per_row )\n      console.log(\"max w\", size, per_row, row_count, max_row_count)\n      ok = (row_count <= max_row_count )\n      if (!ok)\n        size-=1\n      if (size<20){\n        break;\n      }\n    }\n    this.setState({size: size - 2})\n  },\n  componentWillUnmount(){\n    this.unsubscribe()\n  },\n  render(){\n    return <View services={this.state.services} size={this.state.size}/>\n  }\n})\n\nfunction View(props){\n  const style = {\n    width: props.size,\n    minWidth: props.size,\n    height: props.size,\n    cursor: \"pointer\"\n  }\n  return (\n    <div className=\"ui heatmap\" style={{justifyContent:\"center\"}}>\n      {props.services.map( (s) => (\n        <span\n          className={`cell ${Serverboards.utils.colorize(s.tags[0] || \"\")}`}\n          title={`${s.name}: ${s.tags.join(', ')}`}\n          data-tooltip={`${s.name}: ${s.tags.join(', ')}`}\n          onClick={() => Serverboards.store.goto(`/services/${s.uuid}`)}\n          style={style}\n          />\n      ) ) }\n    </div>\n  )\n}\n\nfunction main(el, config, extra){\n  console.log(extra)\n  Serverboards.ReactDOM.render(<Model layout={extra.layout}/>, el)\n\n  return function(){\n    Serverboards.ReactDOM.unmountComponentAtNode(el)\n  }\n}\n\nServerboards.add_widget(`${plugin_id}/widget`, main)\n"],"names":["Serverboards","rpc","React","store","plugin_id","Model","createClass","getInitialState","services","getState","serverboard","size","updateServices","setState","componentDidMount","unsubscribe","subscribe","Math","floor","sqrt","props","layout","width","height","state","length","ok","per_row","row_count","max_row_count","ceil","console","log","componentWillUnmount","render","minWidth","cursor","justifyContent","map","s","utils","colorize","tags","name","join","goto","uuid","style","el","config","extra","ReactDOM","unmountComponentAtNode","add_widget","main"],"mappings":"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"}